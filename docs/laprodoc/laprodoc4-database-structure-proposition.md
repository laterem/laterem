# Проект структуры БД сайта
Описание предлагаемой структуры базы данных проекта «Laterem» 

В документе используются термины из [Глоссария](../glossary.md), перед прочтением настоятельно рекомендуется ознакомится с ним. 
Термины из Глоссария выделены *курсивным шрифтом*.

## Общие требования (О.Т.)

База данных должна обеспечить хранение объектов всех сущностей проекта, однозначно фиксировать все понятия и сохранять историю пользовательских событий, вносящих изменения в систему:
1. Хранение объектов *Пользователей*. 
2. Разграничение *Пользователей* на *Учеников* и *Учителей*.
3. Хранение объектов *Работ*, ссылающихся на множество *Задач*.
4. Хранение объектов *Задач*, ссылающихся на множество *Типов задач*.
5. Хранение объектов *Групп*, ссылающихся на множество *Пользователей*.
6. Хранение объектов *Вердиктов*, ссылающихся на *Задачу* и *Ученика*.
7. Фиксация *Назначения Работы*. Установка связей между *Группой* и/или *Пользователем* и *Работой*.
8. Фиксация *Решения Задачи*. Установка связей между *Пользователем*, *Задачей* и *Вердиктом*.
- Ответственность за хранение объектов *Типов задач* **не** лежит на БД. Для этого существует файловая система *Типов задач*.

## Описание предлагаемой структуры БД
БД хранит данные в 5 таблицах:
- `User`
- `Group`
- `Work`
- `Assignment`
- `Record`

### User
#### Реализует пункты О.Т. №1, 2
Таблица, хранящая *Пользователей* системы.
Поля таблицы:
- Данные авторизации: `email`, `login`, `password`, ...
    - Примечание: `password` - поле пароля пользователя. В целях безопасности, поле `password` хранит пароль пользователя в хэшированном виде. Это значит, что после создания пользователя, учитель не может из сайта повторно посмотреть его пароль. В ситуациях, когда ученик забыл свой пароль, подразумевается, что он обратиться к учителю за тем, чтобы перегенерировать пароль, или чтобы учитель дал ему пароль, если тот его где-то записал. 
- Дополнительные данные: `first_name`, `last_name`, ...
- `is_teacher` \[Булевая\] - 1, если *Пользователь* является *Учителем*; 0, если *Пользователь* является *Учеником*.
- `settings` \[Натуральное число\] - код пользовательских настроек.

### Work
#### Реализует пункты О.Т. №3, 4
Таблица, хранящая *Работы* системы.
Поля таблицы:
- Дополнительные данные: `name`, ...
- `author` \[Many-To-One `User` Foreign Key\] - *Пользователь*, составивший *Работу*. 
- `task_names` \[Список строк\] - Названия *Задач* в порядке их нахождения в *Работе*.
- `task_types` \[Список строк\] - Пути к файловым пакетам *Типов задач* в порядке их нахождения в *Работе*
    - Примечание: Сама таблица хранит только сущности *Работы*, однако поля `task_names` и `task_types` в совокупности описывают сущности *Задачей*. Одна *Задача* не может находиться сразу в нескольких *Работах*, поэтому фиксация *Задачей* как сущностей может быть реализована в рамках сущности *Работы*. Учитывая, что в *Работе* *Задач* обычно не больше 30, хранение их в виде пары списков ориентировочно оптимизированнее, чем хранение их в отдельной таблице. 


### Group
#### Реализует пункты О.Т. №5
Таблица, хранящая *Группы* системы.
Поля таблицы:
- Дополнительные данные: `name`, ...
- `users` \[Many-To-Many `User` Foreign Key\] - перечень *Пользователей*, которые входят в *Группу*.
- `owners` \[Many-To-Many `User` Foreign Key\] - перечень *Пользователей*, которые курируют *Группу*.


### Record
#### Реализует пункты О.Т. №6, 8
Таблица, хранящая историю взаимодействия *Ученика* с *Задачей*. Фиксирует *Решение задачи Учеником*, хранит её *Вердикт*.
Поля таблицы:
- Дополнительные данные: время решения, длительность решения, номер попытки, ...
- `user` \[Many-To-One `User` Foreign Key с каскадным удалением\] - *Пользователь*, решивший *Задачу*
- `work` \[Many-To-One `Work` Foreign Key с каскадным удалением\] - *Работа*, в которой находится решённая *Задача*
- `task` \[Строка\] - Название решённой *Задачи* в её *Работе*.
- `verdict` \[Строка из двух символов\] - *Вердикт* решения *Задачи*.
    - Примечание: *Вердикт* не может существовать без *Решения задачи*, ровно как и *Решение задачи* не остаётся без вердикта. Существование одного автоматически подразумевает существование другого, поэтому их можно приравнять к одной сущности, такой, что событие *Решение задачи* полностью описывается соответствующей сущностью *Вердикта*.

### Assignment
#### Реализует пункт О.Т. №7
Таблица, хранящая связи между *Работой* и *Группой* и/или *Пользователем*, которой/ому *Назначили работу*.
Поля таблицы:
- `teacher` \[Many-To-One `User` Foreign Key\] - *Пользователь* *Учитель*, который *Назначил работу*.
- `user` \[Many-To-One Nullable `User` Foreign Key\] - *Пользователь*, которому *Назначили работу* (если *Работу назначили Пользователю*, а не *Группе*).
- `group` \[Many-To-One Nullable `Group` Foreign Key\] - *Группа*, которой *Назначили работу* (если *Работу назначили Группе*, а не *Пользователю*).
- `work` \[Many-To-One `Work` Foreign Key\] - *Работа*, которую *Назначили*.
